{"ast":null,"code":"import { createAction, handleActions } from \"redux-actions\";\nimport { produce } from \"immer\";\nimport { firestore } from \"../../shared/firebase\";\nimport \"moment\";\nimport moment from \"moment\";\nimport firebase from \"firebase/app\";\nimport { actionCreators as postActions } from \"./post\";\nconst SET_COMMENT = \"SET_COMMENT\";\nconst ADD_COMMENT = \"ADD_COMMENT\";\nconst LOADING = \"LOADING\";\nconst setComment = createAction(SET_COMMENT, (post_id, comment_list) => ({\n  post_id,\n  comment_list\n}));\nconst addComment = createAction(ADD_COMMENT, (post_id, comment) => ({\n  post_id,\n  comment\n}));\nconst loading = createAction(LOADING, is_loading => ({\n  is_loading\n}));\nconst initialState = {\n  list: {},\n  is_loading: false\n};\n\nconst addCommentFB = (post_id, contents) => {\n  return function (dispatch, getState, {\n    history\n  }) {\n    const commentDB = firestore.collection(\"comment\");\n    const user_info = getState().user.user;\n    let comment = {\n      post_id: post_id,\n      user_id: user_info.uid,\n      user_name: user_info.user_name,\n      user_profile: user_info.user_profile,\n      contents: contents,\n      insert_dt: moment().format(\"YYYY-MM-DD hh:mm:ss\")\n    }; // firestore에 코멘트 정보를 넣어요!\n\n    commentDB.add(comment).then(doc => {\n      const postDB = firestore.collection(\"post\");\n      const post = getState().post.list.find(l => l.id === post_id); //   firestore에 저장된 값을 +1해줍니다!\n\n      const increment = firebase.firestore.FieldValue.increment(1);\n      comment = { ...comment,\n        id: doc.id\n      };\n      postDB.doc(post_id).update({\n        comment_cnt: increment\n      }).then(_post => {\n        dispatch(addComment(post_id, comment));\n\n        if (post) {\n          dispatch(postActions.editPost(post_id, {\n            comment_cnt: parseInt(post.comment_cnt) + 1\n          }));\n        }\n      });\n    });\n  };\n};\n\nconst getCommentFB = post_id => {\n  return function (dispatch, getState, {\n    history\n  }) {\n    if (!post_id) {\n      return;\n    }\n\n    const commentDB = firestore.collection(\"comment\"); // where로 게시글 id가 같은 걸 찾고,\n    // orderBy로 정렬해줍니다.\n\n    commentDB.where(\"post-id\", \"==\", post_id).orderBy(\"insert_dt\", \"desc\").get().then(docs => {\n      let list = [];\n      docs.forEach(doc => {\n        list.push({ ...doc.data(),\n          id: doc.id\n        });\n      });\n      dispatch(setComment(post_id, list));\n    }).catch(err => {\n      console.log('댓글 정보를 가져올 수가 없네요!', err);\n    });\n  };\n}; // comment는 딕셔너리 구조로 만들어서,\n// post_id로 나눠 보관합시다! (각각 게시글 방을 만들어준다고 생각하면 구조 이해가 쉬워요.)\n\n\nexport default handleActions({\n  [SET_COMMENT]: (state, action) => produce(state, draft => {\n    // let data = {[post_id] : com_list, ...}\n    draft.list[action.payload.post_id] = action.payload.comment_list;\n  }),\n  [ADD_COMMENT]: (state, action) => produce(state, draft => {\n    draft.list[action.payload.post_id].unshift(action.payload.comment);\n  }),\n  [LOADING]: (state, action) => produce(state, draft => {\n    draft.is_loading = action.payload.is_loading;\n  })\n}, initialState);\nconst actionCreators = {\n  getCommentFB,\n  addCommentFB,\n  setComment,\n  addComment\n};\nexport { actionCreators };","map":{"version":3,"sources":["/Users/a111/Desktop/무제 폴더 2/image-community /src/redux/modules/comment.js"],"names":["createAction","handleActions","produce","firestore","moment","firebase","actionCreators","postActions","SET_COMMENT","ADD_COMMENT","LOADING","setComment","post_id","comment_list","addComment","comment","loading","is_loading","initialState","list","addCommentFB","contents","dispatch","getState","history","commentDB","collection","user_info","user","user_id","uid","user_name","user_profile","insert_dt","format","add","then","doc","postDB","post","find","l","id","increment","FieldValue","update","comment_cnt","_post","editPost","parseInt","getCommentFB","where","orderBy","get","docs","forEach","push","data","catch","err","console","log","state","action","draft","payload","unshift"],"mappings":"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","sourcesContent":["import {createAction, handleActions} from \"redux-actions\";\nimport {produce} from \"immer\";\nimport {firestore} from \"../../shared/firebase\";\nimport \"moment\";\nimport moment from \"moment\";\n\nimport firebase from \"firebase/app\";\n\nimport { actionCreators as postActions } from \"./post\";\n\nconst SET_COMMENT = \"SET_COMMENT\";\nconst ADD_COMMENT = \"ADD_COMMENT\";\n\nconst LOADING = \"LOADING\";\n\nconst setComment = createAction(\n    SET_COMMENT,\n    (post_id, comment_list) => ({post_id, comment_list})\n);\nconst addComment = createAction(\n    ADD_COMMENT,\n    (post_id, comment) => ({post_id, comment})\n);\n\nconst loading = createAction(LOADING, (is_loading) => ({is_loading}));\n\nconst initialState = {\n    list: {},\n    is_loading: false\n};\n\nconst addCommentFB = (post_id,contents) => {\n  return function(dispatch, getState, {history}){\n    const commentDB = firestore.collection(\"comment\");\n    const user_info = getState().user.user;\n\n    let comment = {\n      post_id: post_id,\n      user_id: user_info.uid,\n      user_name: user_info.user_name,\n      user_profile: user_info.user_profile,\n      contents: contents,\n      insert_dt: moment().format(\"YYYY-MM-DD hh:mm:ss\"),\n    }\n\n    // firestore에 코멘트 정보를 넣어요!\n    commentDB.add(comment).then((doc) => {\n      const postDB = firestore.collection(\"post\");\n\n\n      const post = getState().post.list.find(l => l.id === post_id);\n      //   firestore에 저장된 값을 +1해줍니다!\n      const increment = firebase.firestore.FieldValue.increment(1);\n\n      comment = {...comment, id:doc.id};\n\n      postDB.doc(post_id).update({ comment_cnt: increment })\n      .then((_post) =>{\n\n        dispatch(addComment(post_id, comment));\n\n        if(post){\n          dispatch(\n            postActions.editPost(post_id, {\n              comment_cnt: parseInt(post.comment_cnt) + 1,\n          }));\n        }\n      })\n    })\n  }\n}\nconst getCommentFB = (post_id) => {\n    return function (dispatch, getState, {history}) {\n        if (!post_id) {\n            return;\n        }\n        const commentDB = firestore.collection(\"comment\");\n\n        // where로 게시글 id가 같은 걸 찾고,\n        // orderBy로 정렬해줍니다.\n        commentDB\n            .where(\"post-id\", \"==\", post_id)\n            .orderBy(\"insert_dt\", \"desc\")\n            .get()\n            .then((docs) =>{\n              let list = [];\n\n              docs.forEach((doc) =>{\n                list.push({...doc.data(), id:doc.id})\n              })\n\n              dispatch(setComment(post_id, list))\n            }).catch(err =>{\n              console.log('댓글 정보를 가져올 수가 없네요!', err)\n            })\n    }\n}\n// comment는 딕셔너리 구조로 만들어서,\n// post_id로 나눠 보관합시다! (각각 게시글 방을 만들어준다고 생각하면 구조 이해가 쉬워요.)\nexport default handleActions(\n  {\n  [SET_COMMENT]: (state, action) =>\n  produce(state, (draft) => {\n    // let data = {[post_id] : com_list, ...}\n    draft.list[action.payload.post_id] = action.payload.comment_list;\n  }),\n[ADD_COMMENT]: (state, action) => produce(state, (draft) => {\n  draft.list[action.payload.post_id].unshift(action.payload.comment);\n}),\n[LOADING]: (state, action) =>\n  produce(state, (draft) => {\n    draft.is_loading = action.payload.is_loading;\n  }),\n},\ninitialState\n);\n\nconst actionCreators = {\n    getCommentFB,\n    addCommentFB,\n    setComment,\n    addComment\n};\n\nexport {\n    actionCreators\n};"]},"metadata":{},"sourceType":"module"}