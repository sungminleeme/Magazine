{"ast":null,"code":"import { createAction, handleActions } from \"redux-actions\";\nimport { produce } from \"immer\";\nimport { firestore, storage } from \"../../shared/firebase\";\nimport \"moment\";\nimport moment from \"moment\";\nconst SET_POST = \"SET_POST\";\nconst ADD_POST = \"ADD_POST\";\nconst setPost = createAction(SET_POST, post_list => ({\n  post_list\n}));\nconst addPost = createAction(ADD_POST, post => ({\n  post\n}));\nconst initialState = {\n  list: []\n};\nconst initialPost = {\n  // id: 0,\n  // user_info: {\n  //     user_name: \"mean0\",\n  //     user_profile: \"https://likerdo-bucket-list.s3.ap-northeast-2.amazonaws.com/yui.jpg\"\n  // },\n  image_url: \"https://likerdo-bucket-list.s3.ap-northeast-2.amazonaws.com/yui.jpg\",\n  contents: \"\",\n  comment_cnt: 0,\n  insert_dt: moment().format(\"YYYY-MM-DD hh:mm:ss\")\n};\n\nconst addPostFB = (contents = \"\") => {\n  return function (dispatch, getState, {\n    history\n  }) {\n    const postDB = firestore.collection(\"post\");\n    const _user = getState().user.user;\n    const user_info = {\n      user_name: _user.user_name,\n      user_id: _user.uid,\n      user_profile: _user.user_profile\n    };\n    const _post = { ...initialPost,\n      contents: contents,\n      insert_dt: moment().format(\"YYYY-MM-DD hh:mm:ss\")\n    };\n    const _image = getState().image.preview;\n    console.log(_image);\n    console.log(typeof _image);\n\n    const _upload = storage.ref(`images/${user_info.user_id}_${new Date().getTime()}`).putString(_image, \"data_url\");\n\n    _upload.then(snapshot => {\n      snapshot.ref.getDownloadURL().then(url => {\n        // url을 확인해봐요!\n        console.log(url);\n      });\n    });\n\n    return; // ~~~.add({추가할 데이터})\n\n    postDB.add({ ...user_info,\n      ..._post\n    }).then(doc => {\n      let post = {\n        user_info,\n        ..._post,\n        id: doc.id\n      };\n      dispatch(addPost(post));\n      history.replace(\"/\");\n    }).catch(err => {\n      console.log(\"작성에 실패\", err);\n    });\n  };\n};\n\nconst getPostFB = () => {\n  return function (dispatch, getState, {\n    history\n  }) {\n    const postDB = firestore.collection(\"post\");\n    postDB.get().then(docs => {\n      let post_list = [];\n      docs.forEach(doc => {\n        let _post = doc.data(); // ['commenct_cnt', 'contents', ..] reduce 함수 공부 /3-3강 18분 설명\n\n\n        let post = Object.keys(_post).reduce((acc, cur) => {\n          if (cur.indexOf(\"user_\") !== -1) {\n            return { ...acc,\n              user_info: { ...acc.user_info,\n                [cur]: _post[cur]\n              }\n            };\n          }\n\n          return { ...acc,\n            [cur]: _post[cur]\n          };\n        }, {\n          id: doc.id,\n          user_info: {}\n        }); // let _post = {     id: doc.id,     ...doc.data() }; let post = {     id:\n        // doc.id,     user_info: {         user_name: _post.user_name,\n        // user_profile: _post.user_profile,         user_id: _post.user_id,     },\n        // image_url: _post.image_url,     contents: _post.contents,     comment_cnt:\n        // _post.comment_cnt,     insert_dt: _post.insert_dt, }; post_list.push(post);\n\n        post_list.push(post);\n      });\n      console.log(post_list);\n      dispatch(setPost(post_list));\n    });\n  };\n}; // reducer draft 검색하기\n\n\nexport default handleActions({\n  [SET_POST]: (state, action) => produce(state, draft => {\n    draft.list = action.payload.post_list;\n  }),\n  [ADD_POST]: (state, action) => produce(state, draft => {\n    draft.list.unshift(action.payload.post);\n  })\n}, initialState); // action creator export\n\nconst actionCreators = {\n  setPost,\n  addPost,\n  getPostFB,\n  addPostFB\n};\nexport { actionCreators };","map":{"version":3,"sources":["/Users/a111/Desktop/무제 폴더 2/image-community /src/redux/modules/post.js"],"names":["createAction","handleActions","produce","firestore","storage","moment","SET_POST","ADD_POST","setPost","post_list","addPost","post","initialState","list","initialPost","image_url","contents","comment_cnt","insert_dt","format","addPostFB","dispatch","getState","history","postDB","collection","_user","user","user_info","user_name","user_id","uid","user_profile","_post","_image","image","preview","console","log","_upload","ref","Date","getTime","putString","then","snapshot","getDownloadURL","url","add","doc","id","replace","catch","err","getPostFB","get","docs","forEach","data","Object","keys","reduce","acc","cur","indexOf","push","state","action","draft","payload","unshift","actionCreators"],"mappings":"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","sourcesContent":["import {createAction, handleActions} from \"redux-actions\";\nimport {produce} from \"immer\";\nimport {firestore, storage} from \"../../shared/firebase\";\nimport \"moment\";\nimport moment from \"moment\";\n\n\nconst SET_POST = \"SET_POST\";\nconst ADD_POST = \"ADD_POST\";\n\nconst setPost = createAction(SET_POST, (post_list) => ({post_list}));\nconst addPost = createAction(ADD_POST, (post) => ({post}));\n\nconst initialState = {\n    list: []\n}\n\nconst initialPost = {\n    // id: 0,\n    // user_info: {\n    //     user_name: \"mean0\",\n    //     user_profile: \"https://likerdo-bucket-list.s3.ap-northeast-2.amazonaws.com/yui.jpg\"\n    // },\n    image_url: \"https://likerdo-bucket-list.s3.ap-northeast-2.amazonaws.com/yui.jpg\",\n    contents: \"\",\n    comment_cnt: 0,\n    insert_dt: moment().format(\"YYYY-MM-DD hh:mm:ss\"),\n}\n\nconst addPostFB = (contents=\"\",) => {\n    return function (dispatch, getState, {history}){\n        const postDB = firestore.collection(\"post\");\n\n        const _user = getState().user.user;\n\n        const user_info = {\n            user_name: _user.user_name,\n            user_id: _user.uid,\n            user_profile: _user.user_profile,\n        }\n        const _post = {\n            ...initialPost,\n            contents: contents,\n            insert_dt: moment().format(\"YYYY-MM-DD hh:mm:ss\"),\n        }\n        \n        const _image = getState().image.preview;\n\n        console.log(_image);\n        console.log(typeof _image);\n\n        const _upload = storage\n      .ref(`images/${user_info.user_id}_${new Date().getTime()}`)\n      .putString(_image, \"data_url\");\n\n      _upload\n      .then((snapshot) => {\n        snapshot.ref\n        .getDownloadURL()\n        .then((url) => {\n          // url을 확인해봐요!\n          console.log(url);\n      })\n    })\n      \n\n\n        return;\n\n        // ~~~.add({추가할 데이터})\n        postDB.add({...user_info, ..._post}).then((doc) =>{\n            let post = {user_info,..._post, id:doc.id};\n            dispatch(addPost(post));\n            history.replace(\"/\");\n        }).catch((err) => {\n            console.log(\"작성에 실패\",err);\n        })\n    }\n}  \n\nconst getPostFB = () => {\n    return function (dispatch, getState, {history}) {\n        const postDB = firestore.collection(\"post\");\n\n        postDB\n            .get()\n            .then((docs) => {\n                let post_list = [];\n                docs.forEach((doc) => {\n                    let _post = doc.data();\n\n                    // ['commenct_cnt', 'contents', ..] reduce 함수 공부 /3-3강 18분 설명\n                    let post = Object\n                        .keys(_post)\n                        .reduce((acc, cur) => {\n\n                            if (cur.indexOf(\"user_\") !== -1) {\n                                return {\n                                    ...acc,\n                                    user_info: {\n                                        ...acc.user_info,\n                                        [cur]: _post[cur]\n                                    }\n                                };\n                            }\n                            return {\n                                ...acc,\n                                [cur]: _post[cur]\n                            }\n                        }, {\n                            id: doc.id,\n                            user_info: {}\n                        });\n\n                    // let _post = {     id: doc.id,     ...doc.data() }; let post = {     id:\n                    // doc.id,     user_info: {         user_name: _post.user_name,\n                    // user_profile: _post.user_profile,         user_id: _post.user_id,     },\n                    // image_url: _post.image_url,     contents: _post.contents,     comment_cnt:\n                    // _post.comment_cnt,     insert_dt: _post.insert_dt, }; post_list.push(post);\n                        post_list.push(post);\n                })\n                console.log(post_list);\n\n                dispatch(setPost(post_list));\n            })\n    }\n}\n\n// reducer draft 검색하기\nexport default handleActions({\n    [SET_POST]: (state, action) => produce(state, (draft) => {\n        draft.list = action.payload.post_list;\n    }),\n\n    [ADD_POST]: (state, action) => produce(state, (draft) => {draft.list.unshift(action.payload.post)})\n}, initialState);\n\n// action creator export\nconst actionCreators = {\n    setPost,\n    addPost,\n    getPostFB,\n    addPostFB,\n};\n\nexport {\n    actionCreators\n};"]},"metadata":{},"sourceType":"module"}